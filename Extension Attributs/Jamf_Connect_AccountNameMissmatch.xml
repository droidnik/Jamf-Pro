<?xml version="1.0" encoding="UTF-8"?><extensionAttribute>
<displayName>Jamf Connect - Account Name Mismatch</displayName>
<description>Analyzes account mismatches by comparing NetworkUser with preferred_username from Jamf Connect State and IdToken name with local RealName to identify both unsynchronized accounts and name changes after synchronization.</description>
<dataType>string</dataType>
<scriptContentsMac>#!/bin/zsh&#13;
&#13;
# ==== JAMF CONNECT - COMPREHENSIVE ACCOUNT NAME ANALYSIS ====&#13;
# Zweck: Vollständige Analyse von Account-Mismatches&#13;
# 1. NetworkUser vs preferred_username (noch nicht synchronisiert)&#13;
# 2. IdToken name vs lokaler RealName (Namensänderung nach Sync)&#13;
&#13;
# Get current signed in user&#13;
currentUser=$(stat -f%Su /dev/console)&#13;
&#13;
# Skip system users&#13;
if [[ "$currentUser" == "loginwindow" ]] || [[ "$currentUser" == "_mbsetupuser" ]] || [[ "$currentUser" == "root" ]]; then&#13;
    echo "&lt;result&gt;No regular user logged in&lt;/result&gt;"&#13;
    exit 0&#13;
fi&#13;
&#13;
# Check if user exists&#13;
if ! id "$currentUser" &amp;&gt;/dev/null; then&#13;
    echo "&lt;result&gt;User $currentUser does not exist&lt;/result&gt;"&#13;
    exit 0&#13;
fi&#13;
&#13;
# ==== GET PREFERRED USERNAME FROM JAMF CONNECT STATE ====&#13;
jamfConnectStateFile="/Users/${currentUser}/Library/Preferences/com.jamf.connect.state.plist"&#13;
&#13;
# Check if Jamf Connect State file exists&#13;
if [[ ! -f "$jamfConnectStateFile" ]]; then&#13;
    echo "&lt;result&gt;Local account - no Jamf Connect state found&lt;/result&gt;"&#13;
    exit 0&#13;
fi&#13;
&#13;
# Get preferred_username from IdToken in Jamf Connect State&#13;
preferredUsername=$(sudo -u "$currentUser" /usr/libexec/PlistBuddy -c "Print :IdToken:preferred_username" "$jamfConnectStateFile" 2&gt;/dev/null)&#13;
&#13;
if [[ -z "$preferredUsername" ]]; then&#13;
    echo "&lt;result&gt;ERROR: No preferred_username found in Jamf Connect state&lt;/result&gt;"&#13;
    exit 0&#13;
fi&#13;
&#13;
# Get name from IdToken (for display name comparison)&#13;
idTokenName=$(sudo -u "$currentUser" /usr/libexec/PlistBuddy -c "Print :IdToken:name" "$jamfConnectStateFile" 2&gt;/dev/null)&#13;
&#13;
# Get NetworkUser from Directory Service&#13;
networkUser=$(dscl . -read /Users/${currentUser} | grep "^NetworkUser:" | awk -F': ' '{print $2}' | xargs)&#13;
&#13;
if [[ -z "$networkUser" || "$networkUser" == "NetworkUser:" ]]; then&#13;
    echo "&lt;result&gt;ERROR: No NetworkUser found&lt;/result&gt;"&#13;
    exit 0&#13;
fi&#13;
&#13;
# Get RealName from local user account (robust method for single/multiline)&#13;
realName=$(dscl . -read /Users/${currentUser} RealName 2&gt;/dev/null | sed '1d' | tr -d '\n' | sed 's/^[[:space:]]*//' | sed 's/[[:space:]]*$//')&#13;
&#13;
# Fallback: try alternative method if RealName is empty&#13;
if [[ -z "$realName" ]]; then&#13;
    realName=$(dscl . -read /Users/${currentUser} | grep "^RealName:" | sed 's/^RealName:[[:space:]]*//' | tr -d '\n' | sed 's/^[[:space:]]*//' | sed 's/[[:space:]]*$//')&#13;
fi&#13;
&#13;
# ==== COMPREHENSIVE ANALYSIS ====&#13;
networkUserMismatch=false&#13;
nameMismatch=false&#13;
&#13;
# Check 1: NetworkUser vs preferred_username (not yet synchronized)&#13;
# Convert both to lowercase for case-insensitive comparison (email addresses)&#13;
networkUserLower="${networkUser:l}"&#13;
preferredUsernameLower="${preferredUsername:l}"&#13;
&#13;
if [[ "$networkUserLower" != "$preferredUsernameLower" ]]; then&#13;
    networkUserMismatch=true&#13;
fi&#13;
&#13;
# Check 2: IdToken name vs RealName (name change after sync)&#13;
if [[ -n "$idTokenName" &amp;&amp; -n "$realName" &amp;&amp; "$idTokenName" != "$realName" ]]; then&#13;
    nameMismatch=true&#13;
fi&#13;
&#13;
# Build comprehensive result&#13;
if [[ "$networkUserMismatch" == "true" &amp;&amp; "$nameMismatch" == "true" ]]; then&#13;
    echo "&lt;result&gt;DOUBLE MISMATCH: NetworkUser ($networkUser ≠ $preferredUsername) + Name ($realName ≠ $idTokenName)&lt;/result&gt;"&#13;
elif [[ "$networkUserMismatch" == "true" ]]; then&#13;
    echo "&lt;result&gt;NETWORK MISMATCH: NetworkUser ($networkUser) ≠ preferred_username ($preferredUsername)&lt;/result&gt;"&#13;
elif [[ "$nameMismatch" == "true" ]]; then&#13;
    echo "&lt;result&gt;NAME CHANGE DETECTED: RealName ($realName) ≠ IdToken name ($idTokenName) | NetworkUser OK&lt;/result&gt;"&#13;
else&#13;
    echo "&lt;result&gt;SYNCHRONIZED: NetworkUser = $networkUser | RealName = $realName&lt;/result&gt;"&#13;
fi
</scriptContentsMac>
</extensionAttribute>
